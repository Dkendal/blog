+++
title = "Batch export Org-mode pages"
author = ["Dylan Kendal"]
date = 2020-05-07T00:00:00-04:00
lastmod = 2020-06-27T17:28:22-04:00
tags = ["emacs", "orgmode", "hugo"]
draft = false
weight = 2001
+++

A common task if, like me you use _org-mode_ to to create static
websites, is exporting the document to your destination format.
Take this blog for instance. It's written in _org-mode_, which is
exported to _markdown_ for use by _hugo_ which will then compile it
to _html_. The obvious choice for exporting your content would be
to call the command directly within Emacs, but say you wanted to do
this as a part of some other build process or as part of an
automated continuous deployment process it would be nessecary to
invoke the export command from the shell.

Fortunately, Emacs provides the ability to use it in a non-interactive
manner via the `--batch` flag.

```text
--batch                     do not do interactive display; implies -q
--no-init-file, -q          load neither ~/.emacs nor default.el
```

Running Emacs in batch mode we just need to open our _org-mode_
document, either programmaticly or with the `--visit FILE` flag, load
whatever org-mode exporter library, and call it's export function. I'm
using _ox-hugo_ so that's what'll I'll reuqire. It's also nessecary to
ensure the Emacs can actually load this library; the easiest way I
know how to do this is to call `(package-initialize)` to load _all_
packages so I don't need to adjust load paths any load individual
packages.

So the solution for my particular situation where I'm exporting the
entire document to markdown intended for hugo as part of a build
process on my own machine looks like this:

{{< highlight shell >}}
#!/bin/sh

index=./content-org/index.org

progn="(progn
  (package-initialize)
  (require 'ox-hugo)
  (org-hugo-export-wim-to-md :all-subtrees nil nil))"

emacs --batch --visit "$index" --eval "$progn" --kill
{{< /highlight >}}

The `--eval` flag is used to run my string of commands, but you
could just as easily put these command in their own _dot el_ file
and load that - or put each _sexp_ as it's own argument to
`--eval`.

Note that this isn't tested for a contiuous deployment environment
and you'd likely have to adjust a few things to ensure that
packages are available and what not.

Only three posts in and I've already managed to make a meta post
about how this blog is created.